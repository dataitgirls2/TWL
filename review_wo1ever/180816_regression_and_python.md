# 180816

## 오후수업 통계이론

### 1. 상관분석

#### 상관분석

- 상관분석(Correlation Analysis): 두 개의 연속형 변수에 대해서, 상관계수를 이용하여 선형관계를 분석.
- 상관계수(Correlation Coefficient): 표본 상관계수 (r)
  - 상관계수의 범위는 -1~1 사이
  - r이 양수이면 양의 상관관계, 음수이면 음의 상관관계를 의미
  - 값의 크기는 선형관계의 강도를 의미(절대값의 크기)
    - r = 1, -1 이면, 완벽한 선형 관계
    - r = 0이면 선형관계가 없음을 나타냄.
- 상관계수는 반드시 산점도와 함께 계산해야 함!

#### 상관분석의 가설과 검정

- 귀무가설: 두 자료의 관련성이 없다. (상관계수 = 0)
- 대립가설: 두 자료의 관련성이 있다. (상관계수 != 0)

#### 가설검정 결과 해석

- p-value가 유의수준보다 작을 경우, 귀무가설을 기각하고 `두 자료는 관련성이 있다.` 고 해석함.

### 2. 회귀분석

#### 회귀분석(Linear Regression)

- 회귀분석: 두 변수(독립/종속) 사이의 통계적 유의미성을 검증하고, 또 그 관계의 정도를 분석하는 것.
  - 독립변수, 설명변수 (independent variable, explanatory variable, X)
  - 종속변수, 반응변수 (dependent variable, response variable, Y)

#### 단순선형회귀분석(Simple Linear Regression Analysis)

- 단순선형회귀분석: 설명변수가 한 개인 선형회귀모형을 의미함.
- Y, X로 이루어진 식으로 나타낼 수 있음.

#### 다중선형회귀분석(Multiple Linear Regeression Analysis)

- 다중선형회귀분석: 설명변수가 두 개 이상인 선형회귀모형을 의미함.
- Y, X1, X2, X3, ... 로 이루어진 식으로 나타낼 수 있음.

#### 선형(Linear) 회귀 모형

- 선형회귀분석은 가지고 있는 데이터를 직선 형태로 나타내는 선을 찾는다.

#### 회귀식 구하기

- 다양한 회귀선을 구할 수 있음.

#### 최소 제곱 추정법(Ordinary Least Square: OLS)

- 최고 제곱 추정법: 실제 값과 예측한 값의 차이에 대한 제곱을 모든 관측치에 대해 계산하여 합했을 때 가장 작게하는 회귀식을 선택함.
- 오차제곱의 합이 가장 작은 회귀식을 구함.

#### 회귀분석 가정

회귀분석은 다음과 같은 가정을 바탕으로 함.

- 선형성: x와 y는 선형관계
- 오차에 대한 가정:
  - 정규성: 오차는 정규분포를 따름. (y는 정규분포를 따름, 각 x값에 대하여 모집단에서의 y값은 정규분포를 따름.)
  - 등분산성: 오차는 모든 x값에서 동일한 분산을 가짐.
- 독립변수(x) 상호간에는 상관관계가 없어야 한다.
  - 독립변수들 간에 상관관계가 나타나는 경우를 '다중공선성' 이라고 함.

#### 회귀분석 가정의 확인

- 선형성: 산점도 등의 그림을 그려 파악
- 정규성1: 히스토그램을 그려본 후 정규분포 모양을 띄는 지 확인.
- 정규성2: Q-Q plot을 그려본 후 직선 위에 위치하는 지 확인(직선 위에 점들이 모여있다면 데이터는 정규분포를 따른다고 할 수 있음.)
- 다중공선성: 독립변수(x)들간의 상관계수가 높은 상황.
  - 문제점: 회귀계수의 분산이 커짐. (회귀분석 결과가 유의하지 않을 수도 있음.)
  - 해결방법: 1) 상관관계가 높은 독립변수 중 하나 혹은 일부를 제거함. 2) 변수를 변환함. 3) PCA방법을 이용해 공선성을 제거해줌.

#### 지시변수(Dummy Variable)

- 지시변수: 범주형 변수를 처리하기 위해 (class -1)개의 1, 0으로 이루어지 변수로 변환시킨 변수

#### 범주형 변수의 해석

- 기본이 되는 범주에 비교했을 때 Y의 평균 차이량
  - yhat = 370.35 + 3.14이디야 - 4.96투썸
  - (eg) 이디야 커피가 스벅 커피보다 평균 3.14kcal 더 높음.
  - 투썸 커피가 스벅 커피보다 평균 4.96kcal 더 낮음.

#### 파생변수

- 항상 데이터가 분석에 적합하도록 되어있지는 않음.
- 따라서 분석 목적에 유의미하고 적합한 변수를 개발하는 것이 중요함.
- 파생변수: 기존의 변수를 가지고 특정 조건을 만족하거나 특정 함수에 의해 값을 만들어 의미를 부여한 변수

#### 파생변수 생성방법

- 도메인 & 데이터 자체에 대한 지식
  - (eg) 산불에 영향을 미치는 인자는 그 날의 습도가 아니라 누적 3일 치의 평균습도임. 따라서 습도 변수를 가지고 누적 3일치의 평균습도를 만들어야 함.
  - "자신이 분석하고 있는 데이터 분야에 대한 공부를 하거나 관련 전문가와 의논을 해야 의미있는 파생 변수를 만들 수 있음."
- EDA를 통해 인사이트 얻기
  - (eg) 날짜별로 매출액을 찍어보니, 월말에 유독 상승하는 경향이 있음. (월말이면 1, 아니면 0)
- 상호작용 변수(교호작용 변수, interaction variable) 추가
- 그 외
  - 매우 주관적일 수 있으므로 논리적 타당성을 갖추어 개발해야 함.

#### 교호작용

- interaction 교호(상호)작용 변수란?

  : 한 변수의 효과가 다른 변수의 수준에 의존하는 경우( = 두 자료의 효과를 동시에 고려하는 경우)

  (eg) 흡연을 하면 건강 -3, 음주를 하면 건강 -2, 흡연과 음주를 했을 때 -5라면 교호작용 변수를 고려하지 않아도 됨.

  하지만 흡연과 음주를 동시에 한 결과 건강이 -10된다면 교호작용 변수를 고려해야 함.

  - 상호작용 변수 없는 기존 모델: 건강 ~ 흡연 + 음주
  - 상호작용 변수 추가한 모델: 건강 ~ 흡연 + 음주 + 흡연*음주

- 교호작용은 보통 범주형*범주형 변수나, 범주형\*연속형 변수의 관계만 봄.

  - eg) x(대졸여부, 경력), y(임금): 경력이 1년 늘어날 때, 학력에 따라 임금차이가 난다면 교호작용 필요.

- 교호작용을 확인하는 방법

  - 도메인 & 데이터에 대한 지식
  - interaction plot - 그래프의 선들이 평행하지 않거나, 교차하는 경우
  - EDA - 하나의 변수가 연속형, 하나의 변수가 범주형일 때 사용하기에 유용.
  - tree
  - 교호작용 변수를 넣을 시 기존에 있는 변수(주 효과)를 꼭 넣어줘야 함.

- 교호작용 변수를 사용하면 변수의 해석이 복잡해지는 단점이 존재.

#### 데이터 분할

- train data: 모델을 세우기 위한 데이터
- test data: 모델의 성능을 평가하기 위한 데이터

#### 데이터 분할이 필요한 이유

- 전체 데이터를 가지고 모델을 적합한다면? 모델을 만드는 목적이 주어진 데이터만 설명하는 거라면 그렇게 해도 되지만, 우리가 이 모델을 가지고 미래를 예측하고 싶을 때는 올바른 방법이 아님.
- 일반적으로 모델을 만드는 우리의 목적은 다른 상황에서도 적용 가능한 모델을 만들기 위해서임. 하지만 가지고 있는 데이터로만 모델을 만들고 적합한다면 overfitting의 위험성이 존재.

#### 데이터 분할

- Train/Test set을 나누는 방법에는 여러가지 방법이 있지만 본 수업에서는 random 함수를 이용해 데이터를 나눔.

#### 변수 선택의 필요성

- 독립변수의 수가 지나치게 많다면?
  - 실제와는 다른 결과가 얻어질 수 있음. 특히 독립변수들 간의 상관성이 높아진다면 결과가 잘못 될 가능성이 높아짐.
  - 차원의 저주: overfitting의 문제
  - 유의하지 않은 변수들도 계속 사용해야 함.

#### 변수 선택 방법

1. 전진 선택법(Forward Selection)
   - 설명변수가 하나도 없는 모델에서부터 시작하여 가장 유의미한 변수를 하나씩 추가해 나가는 방법
2. 후진 제거법(Backwrad Elimination)
   - 모든 변수를 사용하여 구축한 모델에서 유의미하지 않은 변수를 하나씩 제거해나가는 방법
3. 단계적 선택법(Stepwise Selection)
   - 설명변수가 하나도 없는 모델에서부터 시작하여 전진선택법과 후진소거법을 번갈아가며 수행

#### 변수 선택 방법 - 실습

- 파이썬에서는 변수선택에 관한 함수들이 따로 존재하지 않음.
- 따라서 본인이 함수를 직접 만들어야 함.

#### 잔차분석

- 잔차분석: 회귀분석 모형을 적합한 후 이 모형의 결함을 찾아내는 데 가장 간단하고 효과적인 방법(회귀분석 가정 중 오차의 **등분산성** 가정을 만족하는 지 확인 가능)
- 잔차(residual):
  - 실제 관측값 - 예측값
  - 회귀모형에서 오차항은 측정할 수 없으므로 오차를 대신하는 값으로 해석하며 오차항에 대한 가정을 판단함(정규성, 등분산성, ... )

#### 잔차분석 방법

1. 잔차 vs 예측값(yhat)의 산점도
2. 잔차 vs 반응변수(x)의 산점도
   - 잔차는 반응변수(x)와 관련성이 없어야 하므로, 그림에 패턴이 없어야 함.
   - 패턴이 존재한다면 가정 위반
3. 잔차의 정규확률 플롯(Q-Q plot)
   - 오차의 정규성 확인

#### 잔차그림 해석

- 직선 띠 모양, 랜덤한 모양: 바람직한 형태
- 잔차의 비선형적인 트렌드가 보이는 형태(곡선의 형태): 이차항이나 다차항을 넣어주기
- 등분산성을 만족하지 않음: 변수변환이나 가중치 주기

#### 모형의 적합도, 설명력: 결정계수(R-square)

- 결정계수(R^2): X가 Y를 얼마나 설명하는지에 관한 정보를 제공 (회귀식이 얼마나 정확한지)
- 반응변수(Y)의 전체 변동(SST) 중 예측변수(X)가 차지하는 변동(SSR)의 비율
- r = corr(y,  yhat)
- R^2 = 1: 회귀직선으로 Y를 완전히 설명할 수 있음(회귀식의 정확도는 매우 높다)
- R^2 = 0: 추정된 회귀직선은 X와 Y의 관계를 전혀 설명하지 못함(회귀식의 정확도는 매우 낮다)

#### 모형의 적합도: 결정계수(R-square)

- R^2 = 0.8
  - 추정된 회귀식으로 아들의 키를 80% 설명할 수 있음.
  - 아들의 키(y)는 아버지의키(x)에 의해 80% 설명됨.

#### 모형의 적합도2: 수정된 결정계수

- 결정계수(R^2)의 단점: 변수의 개수가 늘어나면 결정계수(R^2)는 커짐.
- 따라서 모델 판단의 기준을 결정계수로 선택한다면 변수가 많은 모델을 선택할 경향이 높음.
- 수정된 결정계수(adj R-square): 변수의 개수를 고려한 결정계수
  - adj R^2 < R^2
- 다중 회귀분석에서 모델 선택의 기준은 결정계수보다는 수정된 결정계수가 더 적절.

#### 예측력 평가

- MSE(Mean Square Error: 평균제곱오차)
- RMES(Root Mean Squared Error: 평균 제곱근 오차)

#### 모델선택의 기준

- 모델 설명력, 적합도
  - R^2
  - adj R^2
- 예측력
  - MSE(RMSE)
  - 예측 그래프 - 약간 주관적이 될 수 있으니 수치적으로 확인하는 편이 좋음

모델 선택은 본인이 정한 하나의 기준으로 판단하면 됨!

#### 분석 Prosess 정리

| 문제정의  | 분석목적 설정, 데이터 수집, 데이터 정제 및 처리              |
| --------- | ------------------------------------------------------------ |
| EDA       | 각 변수들의 분포 확인(missing, outlier 확인 및 처리 ...), 회귀분석 가정 확인(선형성, 정규성 ,다중공선성), 파생변수 생성 |
| modeling  | 회귀분석, xgboost, randomforest, ...                         |
| 변수선택  | forward, backward, stepwise, ... (선형 모형에서 가능)        |
| 잔차분석  | residual plot, partial residual plot, ...                    |
| 모델 수정 | 잔차 확인 후 추가적인 파생변수 고려                          |
| 모형 비교 | 각 모델 별로 perfomance 확인                                 |

