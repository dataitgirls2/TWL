# 180907

## 오후 통계수업-군집분석 지현쌤

### 복습 - 잔차분석



### 군집분석 사례

#### 고객 세분화 및 마케팅 전략 수립

#### 군집화에 따른 새로운 insight발견

#### 군집별로 다로 모델 수립

시군구별 특성이 존재한다면, 전체 시군구에 대한 모델보다 각각의 군집에 대한 모델을 만드는 것이 더 좋은 경향이 있음.

군집분석 자체가 목적이 될 수도 있고, 모델링을 위한 수단이 될 수도 있음.



### 군집분석이 필요한 이유

- 데이터를 속성이 비슷한 개체끼리 분류할 수 있음
  - 관리 편의성 및 효율성 증가
  - (eg) 게임 유저들의 일주일동안 획득한 경험치의 양과 플레이 시간으로 4개의 군집 설정
- 평균의 함정에 빠지지 않음
  - 평균의 함정: 집단의 평균이 집단에 속한 각 개체의 특성을 잘 반영해주지 못하는 현상



### 군집분석이란?

1. 문제제기
   - 유사한 특성을 가지고 있는 고객들기리 어떻게 같은 군집으로 분류할 것인가?
2. 분석 결과
   - 서로 유사한 특성을 가지는 고객군 군집 도출
3. 활용
   - 고객의 세분화
     - 고객집단 별 인구통계학적, 사회적, 행태적 특성 파악
     - 집단의 프로필 작성 및 특성파악
   - 군집별로 추가분석을 함.
     - 자료의 전반적인 분포형태를 파악함.
     - 군집별로 추가 분석을 함.

#### 군집분석

유사성 정도에 따라 그룹화(군집 내 동질성, 군집 간 이질성)

#### 유사성 측도

유사성 정도를 나타내주는 도구

- 유클리디안 거리
- 맨하탄 거리



### 군집분석 방법

#### 계층적 군집분석 VS 비계층적 군집분석

**계층적 군집분석**

- 단일, 완전, 평균, 중심결합기준, 와드방식
- 개별대상 간의 거리에 의하여 가장 가까이 있는 대상들로부터 시작하여 결합해 감으로써 나무모양의 계층구조를 형성해가는 방법
  - 장점: 군집이 형서되는 과정을 정확하게 파악할 수 있음.
  - 단점: 자료의 크기가 크면 분석하기 어려움
- 한 군집 안에 부분군집을 가질 수 있음.

**비계층적 군집분석**

- K-menas clustering
- 군집의 수를 정한 상태에서 설정된 군집의 중심에 가장 가까운 개체를 하나씩 포함해가는 방식으로 군집을 형성하는 방법
  - 장점: 많은 자료를 빠르고 쉽게 분류
  - 단점: 군집의 수를 미리 정해주어야 하고, 군집을 형성하기 위한 초기값에 따라 군집결과가 달라짐.
- 군집 간 겹치는 부분이 없고 상호 배타적

#### k-means 예제 -iris data

k개의 수, 변수의 종류에 따라 군집화가 달라짐



### K-means

#### k-평균 알고리즘(k-means algotithm)

데이터를 k개의 그룹으로 군집화

1. 초기화

   - 랜덤하게 4개의 초기 중심값을 선택

     1) 무작위 분할: 데이터를 랜덤하게 4개의 그룹으로 분할 후 그룹의 중심값을 초기 중심값으로 설정

     2) Forgy Algorithm: 임의의 4개의 데이터를 초기 중심값으로 설정

2. 그룹설정

   - 유클리디안 거리를 이용해 4개의 군집으로 나눔

3. 그룹 중심 재조정
   - 군집 된 데이터를 이용해 중심을 다시 구함
4. 그룹 재 결정
   - 새로 설정된 중심값을 기준으로 군집을 재설정
5. 그룹 중심 재조정
   - 군집된 데이터를 이용해 중심을 다시 구함
6. 알고리즘 종료
   - 군집된 데이터가 이전이 군집 데이터와 동일하면 알고리즘 종료

K-means 군집방법을 K개의 개수를 정해줘야 함.

>  최적의 k개의  수를 어떻게 구할까?

#### k-평균 알고리즘엣서 최적의 k값 선택하기

**elbow method (팔꿈치 방법)**

- 군집 내 유사성을 오차제곱합(SSE)으로 계산함
- 오차제곱합이 작을수록 군집 내 유사성이 높다고 해석
- 값의 변화 비율이 급격히 작아지는 부분을 선택

**x축에 따라 군집이 나눠짐을 볼 수 있음**

- 이렇게 각 변수마다 분산이 다르다면 분산이 큰 것에 의해 군집이 결정될 수 있음
- 따라서 각각의 변수의 분산을 동일하게 해주는 표준화 과정이 필요함

**참고) k-means 군집분석은 이상치도 주의해야 한다. 이상치에 따라 군집 결과가 왜곡될 수 있다.**

scaling은 내가 보려는 데이터의 특성에 따라 할 지, 안 할 지 결정됨.



### 계층적 군집분석

#### 계층적 군집분석(hierarchical clustering)

#### 계층적 군집분석 방법

1. 상향식(bottom-up, Agglomerative)
2. 하향식(top-down, Divisive)

#### 상향식(Agglomerative)

- 각각의 데이터는 단일 군집으로 시작
- 가까운 군집과 결합
- 모든 데이터가 하나의 군집이 되면 군집분석 종료
- 보통 상향식을 많이 사용(하향식은 계산량이 너무 많음)

상향식 계층적 군집분석은 클러스터 계층 구조가 dendrogram (트리)로 표시됨. 수평선을 그렷서 군집의 분리를 확인할 수 있음.

#### 군집분석 비교

**계층적 군집분석**

- 단일, 완전, 평균, 중심결합기준, 와드방식
- 개별대상 간의 거리에 의하여 가장 가까이 있는 대상들로부터 시작하여 결합해 감으로써 나무모양의 계층구조를 형성해가는 방법
  - 장점: 군집이 형서되는 과정을 정확하게 파악할 수 있음.
  - 단점: 자료의 크기가 크면 분석하기 어려움
- 한 군집 안에 부분군집을 가질 수 있음.

**비계층적 군집분석**

- K-menas clustering
- 군집의 수를 정한 상태에서 설정된 군집의 중심에 가장 가까운 개체를 하나씩 포함해가는 방식으로 군집을 형성하는 방법
  - 장점: 많은 자료를 빠르고 쉽게 분류
  - 단점: 군집의 수를 미리 정해주어야 하고, 군집을 형성하기 위한 초기값에 따라 군집결과가 달라짐.



### 계층적 군집분석 실습

공유 폴더 내 ipynb 실습 파일, data8 스프레드시트 - shopping data

다양한 방법을 적용해 보아야 함.

- 계층적 군집분석 - 단일, 완전, 와드, 중심결합기준 방식
- 비 계층적 군집분석 - k-means clustering

### 군집분석 단계

1. 변수 선택 - 군집화를 위한 속성 선별

   (eg) 우울증에 관한 연구 - 나이, 성별, 정신과적 증상, 지속기간, ...

2. 데이터 표준화

3. 이상치 처리

4. 군집 알고리즘 선택 & 거리의 계산

5. 군집의 개수 설정

6. 분석결과의 시각화 및 해석



